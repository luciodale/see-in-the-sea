---
import { getCategoriesByContestId, getJudgesByContestId } from './queries';

type Props = {
  contestTitle: string;
  contestId: string;
  activeCategoryId?: string;
};

const { contestTitle, contestId, activeCategoryId } = Astro.props;

if (!Astro.locals.runtime.env.DB) {
  throw new Error('DB is not available');
}

const contestJudges = await getJudgesByContestId(
  Astro.locals.runtime.env.DB,
  contestId
);

const contestCategories = await getCategoriesByContestId(
  Astro.locals.runtime.env.DB,
  contestId
);
---

<div class="space-y-12">
  <!-- Contest Title -->
  <div class="text-center">
    <h1 class="text-5xl font-thin text-gray-50 uppercase">
      {contestTitle}
    </h1>
  </div>

  <!-- Categories -->
  <div class="space-y-6">
    <h2 class="text-3xl font-light tracking-widest text-center">CATEGORIES</h2>
    <div class="flex flex-wrap justify-center gap-4 sm:gap-6">
      <!-- Winners tag -->
      <div class="group relative">
        <a
          href={`/contest/${contestId}`}
          class={`category-button ${
            !activeCategoryId
              ? 'category-button--active'
              : 'category-button--inactive'
          }`}
        >
          <span class="text-lg font-light tracking-wide uppercase">
            Winners Only
          </span>
        </a>
      </div>

      {
        contestCategories.map(category => {
          const isActive = activeCategoryId === category.id;
          return (
            <div class="group relative">
              <a
                href={`/contest/${contestId}/${category.id}`}
                class={`category-button ${
                  isActive
                    ? 'category-button--active'
                    : 'category-button--inactive'
                }`}
              >
                <span class="text-lg font-light tracking-wide uppercase">
                  {category.name}
                </span>
              </a>
            </div>
          );
        })
      }
    </div>
  </div>

  <!-- Jury -->
  <div class="space-y-4 bg-slate-800/60 py-6">
    <h2 class="text-3xl font-light tracking-widest text-center">JURY</h2>
    <ul
      class="text-2xl flex flex-col sm:flex-row items-center justify-center gap-4 sm:gap-10 text-gray-300"
    >
      {
        contestJudges.map(judge => (
          <li class="font-extralight">{judge.fullName}</li>
        ))
      }
    </ul>
  </div>
</div>
